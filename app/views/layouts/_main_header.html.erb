<% unless current_user.present? %>
  <%# Show login button only if NOT on the sign-in page %>
  <% unless controller_name == 'sessions' && action_name == 'new' || 
            (controller_name == 'registrations' && action_name == 'new')||
            (controller_name == 'passwords' && action_name == 'new')%>
    <div class="d-flex justify-content-end p-3 bg-white border-bottom">
      <%= link_to 'Login', new_user_session_path, class: "btn btn-primary" %>
    </div>
  <% end %>
<% else %>
  <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom px-3">
    <%= link_to root_path, class: "navbar-brand d-flex align-items-center gap-2" do %>
      <%= image_tag "logo.png", alt: "Study Portal Logo", height: "60" %>
    <% end %>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <% if current_user.present? %>
    <div class="collapse navbar-collapse" id="navbarNav">
      <!-- Left Navigation -->
      <ul class="navbar-nav me-auto">
        <li class="nav-item">
          <%= link_to 'Search', courses_path, class: "nav-link #{current_page?(courses_path) ? 'active' : ''}" %>
        </li>
        <li class="nav-item">
          <%= link_to 'Map Search', map_search_universities_path,
              class: "nav-link #{controller_name == 'universities' && action_name == 'map_search' ? 'active' : ''}",
              data: { turbo: false } %>
        </li>
        <% if current_user.admin? %>
          <li class="nav-item">
            <%= link_to 'Admin', rails_admin_path,
                class: "nav-link #{request.fullpath.starts_with?('/admin') ? 'active' : ''}",
                data: { turbo: false } %>
          </li>
        <% end %>
      </ul>

      <!-- Right-side controls -->
      <div class="d-flex align-items-center ml-4">
        <!-- Currency Dropdown -->
        <div class="dropdown me-3" data-controller="currency">
          <button class="btn btn-link nav-link dropdown-toggle" type="button" id="currencyDropdown" data-bs-toggle="dropdown" aria-expanded="false" data-action="click->currency#toggleDropdown">
            <i class="fas fa-money-bill-wave"></i>
            <%= session[:currency] || 'USD' %>
          </button>
          <ul class="dropdown-menu" aria-labelledby="currencyDropdown">
            <% %w[USD GBP CAD EUR AED SGD AUD NZD JPY CHF THB MYR CNY HKD INR].each do |currency| %>
              <li>
                <%= form_tag set_currency_path, method: :post, data: { turbo: false } do %>
                  <%= hidden_field_tag :currency, currency %>
                  <%= button_tag currency,
                      class: "dropdown-item #{'active' if session[:currency] == currency}",
                      data: { action: "currency#update" } %>
                <% end %>
              </li>
            <% end %>
          </ul>
        </div>

        <!-- User Dropdown -->
        <div class="dropdown" style="margin-right: 7rem;" data-controller="dropdown">
          <a
            class="btn btn-link nav-link dropdown-toggle"
            href="#"
            id="userDropdown"
            role="button"
            data-action="click->dropdown#toggle"
            aria-expanded="false">
            <%= image_tag "logo.png", class: "rounded-circle", alt: "User", width: "32", height: "32" %>
          </a>

          <ul class="dropdown-menu dropdown-menu-end" data-dropdown-target="menu" aria-labelledby="userDropdown">
            <li><%= button_to 'Logout', destroy_user_session_path, method: :delete, class: "dropdown-item" %></li>
            <li><%= link_to 'Profile', edit_user_registration_path, class: "dropdown-item" %></li>
          </ul>
        </div>
      </div>
    </div>
    <% end %>
  </nav>
<% end %>
<style>
  .dropdown-menu.show {
    display: block;
  }
</style>